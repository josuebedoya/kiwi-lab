---
import directus from "@/server/directus";
import readFile from "@/server/readFile";
import {readSettings} from "@directus/sdk";
import '@/styles/main.scss';
import {PUBLIC_RECAPTCHA_SITE_KEY as KEY} from "astro:env/client";

interface Props {
  title: string;
  description: string;
  image?: string;
  keywords?: string[];
}

const {title, description, image, keywords} = Astro.props;
const siteSettings = await directus.request(readSettings());

let favicon: string | undefined;
if (siteSettings?.public_favicon) {
  favicon = await readFile({id: siteSettings.public_favicon, name: title});
}

let img: string | undefined;

if (image?.startsWith("http") || image?.startsWith("/")) {
  img = image;
} else if (image) {
  img = await readFile({id: image, name: title});
}

const url = Astro.request.url;
---

<head>
 <meta charset="UTF-8"/>
 <link rel="icon" type="image/png" href={favicon}/>
 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <title>{title}</title>
 <meta name="description" content={description}/>
 <link rel="canonical" href={url}/>

 <!-- Indexed robots-->
 <meta name="robots" content="index, follow"/>
 <meta name="googlebot" content="index, follow"/>

 <!-- Keywords -->
  {keywords && (
    <meta name="keywords" content={Array.isArray(keywords) ? keywords.join(', ') : keywords}/>)}

 <!-- Open Graph (Facebook, LinkedIn, WhatsApp) -->
 <meta property="og:title" content={title}/>
 <meta property="og:description" content={description}/>
 <meta property="og:image" content={img}/>
 <meta property="og:url" content={url}/>
 <meta property="og:site_name" content={siteSettings?.public_project_name}/>
 <meta property="og:type" content="website"/>

 <!-- Twitter Cards -->
 <meta name="twitter:card" content="summary_large_image"/>
 <meta name="twitter:title" content={title}/>
 <meta name="twitter:description" content={description}/>
 <meta name="twitter:image" content={img}/>

 <!-- Others -->
 <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
 <meta property="og:locale" content="en_US"/>

  {img && (
    <link rel="preload" as="image" href={img}/>)}

 <!-- ReCAPTCHA -->
 <script defer src={`https://www.google.com/recaptcha/api.js?render=${KEY}`}
 ></script>
</head>
