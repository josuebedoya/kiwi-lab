---
import readFile from "@/server/readFile";
import type { HTMLAttributes } from "astro/types";

interface Props extends HTMLAttributes<"img"> {
  id: string | undefined;
  alt: string;
  width?: number;
  height?: number;
  lazy?: boolean;
  params?: Record<string, string>;
}

const {
  id,
  alt,
  width: wP,
  height: hP,
  lazy = true,
  params,
  ...props
} = Astro.props;

const queryParams = {
  ...(wP ? { width: String(wP).trim() } : {}),
  ...(hP ? { height: String(hP).trim() } : {}),
  ...params,
};

const src = await readFile({ id: id ?? "", name: alt, params: queryParams });
---

<img {...props} src={src} alt={alt} loading={lazy ? "lazy" : "eager"} />
